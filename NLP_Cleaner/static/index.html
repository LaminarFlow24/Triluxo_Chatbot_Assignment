<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Course Search</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 2rem; 
    }
    #results { 
      margin-top: 1rem; 
    }
    .course { 
      border: 1px solid #ccc; 
      padding: 1rem; 
      margin-bottom: 1rem; 
    }
    .course h3 { 
      margin-top: 0; 
    }
  </style>
</head>
<body>
  <h1>Search for Courses</h1>
  <form id="searchForm">
    <input type="text" id="query" placeholder="Enter your search query" required />
    <button type="submit">Search</button>
  </form>

  <div id="results"></div>

  <script>
    document.getElementById('searchForm').addEventListener('submit', async (e) => {
      e.preventDefault();  // Prevent the default form submission behavior

      // Retrieve the user's search query
      const query = document.getElementById('query').value;
      const resultsDiv = document.getElementById('results');
      resultsDiv.innerHTML = "<p>Searching...</p>";

      try {
        // Send a POST request to the /search endpoint
        const response = await fetch("http://127.0.0.1:5000/search", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ query: query, k: 5 })
        });
        const data = await response.json();

        // Clear the results area
        resultsDiv.innerHTML = "";

        // Check if any results were returned
        if (data.results && data.results.length > 0) {
          data.results.forEach(course => {
            const courseDiv = document.createElement("div");
            courseDiv.className = "course";
            courseDiv.innerHTML = `
              <h3>${course.course_name}</h3>
              <p><strong>Link:</strong> <a href="${course.course_link}" target="_blank">${course.course_link}</a></p>
              <p><strong>Details:</strong> ${course.course_details}</p>
              <p><strong>Price:</strong> ${course.course_price}</p>
              <p><strong>Lessons:</strong> ${course.number_of_lessons}</p>
              <p><strong>Description:</strong> ${course.course_description}</p>
              <p><strong>Curriculum:</strong> ${Array.isArray(course.course_curriculum) ? course.course_curriculum.join(", ") : course.course_curriculum}</p>
              <p><em>Distance:</em> ${course.distance.toFixed(4)}</p>
            `;
            resultsDiv.appendChild(courseDiv);
          });
        } else {
          resultsDiv.innerHTML = "<p>No results found.</p>";
        }
      } catch (error) {
        console.error("Error during search:", error);
        resultsDiv.innerHTML = "<p>Error fetching results.</p>";
      }
    });
  </script>
</body>
</html>
